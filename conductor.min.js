(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var s=n[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(n,t,s){return t&&e(n.prototype,t),s&&e(n,s),n}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var Conductor=exports.Conductor=function(){function e(n,t,s){_classCallCheck(this,e),this.channels={},this.isConnected=!1,this.kAllMessages="*",this.ConOpCode=Object.freeze({BindOpcode:0,UnbindOpcode:1,WriteOpcode:2,ServerOpcode:3,CleanUpOpcode:4});var r="?Token";n.indexOf(r)>-1&&(r="&");var a=this;this.socket=new WebSocket(n+r+"="+t),this.socket.onopen=function(e){a.isConnected=!0,null!=s&&s(a.isConnected)},this.socket.onclose=function(e){a.isConnected=!1,null!=s&&s(a.isConnected)},this.socket.onerror=function(e){console.log("Error detected: "+e)},this.socket.onmessage=function(e){a.processMessage(e.data)}}return _createClass(e,[{key:"bind",value:function(e,n){this.channels[e]=n,e!=this.kAllMessages&&this.writeMessage(this.ConOpCode.BindOpcode,e,this.createUUID(),"")}},{key:"unbind",value:function(e){delete this.channels[e],e!=this.kAllMessages&&this.writeMessage(this.ConOpCode.UnbindOpcode,e,this.createUUID(),"")}},{key:"serverBind",value:function(e){this.serverChannel=e}},{key:"serverUnBind",value:function(e){this.serverChannel=null}},{key:"sendMessage",value:function(e,n){this.writeMessage(this.ConOpCode.WriteOpcode,e,this.createUUID(),n)}},{key:"sendServerMessage",value:function(e,n){this.writeMessage(this.ConOpCode.ServerOpcode,e,this.createUUID(),"")}},{key:"disconnect",value:function(){this.isConnected&&(this.channels={},this.socket.close())}},{key:"writeMessage",value:function(e,n,t,s){var r=new ArrayBuffer(6+n.length+t.length+4+s.length),a=new DataView(r),i=0;a.setUint16(i,e,!0),i+=2,a.setUint16(i,t.length,!0),i+=2,i+=this.stringToDataView(a,i,t),a.setUint16(i,n.length,!0),i+=2,i+=this.stringToDataView(a,i,n),a.setUint32(i,s.length,!0),i+=4,i+=this.stringToDataView(a,i,s),this.socket.send(a)}},{key:"createStringFromArray",value:function(e){return this.Utf8ArrayToStr(e)}},{key:"stringToDataView",value:function(e,n,t){for(var s=0,r=t.length;s<r;s++)e.setUint8(n+s,t.charCodeAt(s),!0);return t.length}},{key:"dataViewToString",value:function(e,n,t){var s=new Int8Array(e.buffer.slice(n,n+t));return this.Utf8ArrayToStr(s)}},{key:"Utf8ArrayToStr",value:function(e){var n,t,s,r,a,i;for(n="",s=e.length,t=0;t<s;)switch((r=e[t++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n+=String.fromCharCode(r);break;case 12:case 13:a=e[t++],n+=String.fromCharCode((31&r)<<6|63&a);break;case 14:a=e[t++],i=e[t++],n+=String.fromCharCode((15&r)<<12|(63&a)<<6|(63&i)<<0)}return n}},{key:"parseMessage",value:function(e){var n=new DataView(e),t=0,s=n.getInt16(t,!0);t+=2;var r=n.getInt16(t,!0);t+=2;var a=this.dataViewToString(n,t,r);t+=r;var i=n.getInt16(t,!0);t+=2;var o=this.dataViewToString(n,t,i);t+=i;var c=n.getInt32(t,!0);t+=4;var l=new Int8Array(n.buffer.slice(t,t+c));return t+=c,{opcode:s,uuid_size:r,uuid:a,name_size:i,channel_name:o,body_size:c,body:l}}},{key:"createUUID",value:function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}},{key:"processMessage",value:function(e){var n=new FileReader,t=this;n.addEventListener("loadend",function(){var e=t.parseMessage(n.result);e.opcode==t.ConOpCode.ServerOpcode?null!=t.serverChannel&&t.serverChannel(e):(null!=t.channels[e.channel_name]&&t.channels[e.channel_name](e),null!=t.channels[t.kAllMessages]&&t.channels[t.kAllMessages](e))}),n.readAsArrayBuffer(e)}}]),e}();window.Conductor=Conductor;

},{}]},{},[1]);
